"use strict";let keepChecking;let stompClient;let modal;document.addEventListener("DOMContentLoaded",function(){M.AutoInit();const a=document.querySelectorAll(".modal");M.Modal.init(a,{onCloseEnd:function(){$.ajax({type:"PUT",url:"http://"+$("#address").val()+":"+$("#port").val()+"/cancelSearch",contentType:"application/json",timeout:0})}});M.Modal.getInstance($("#searchModal"));console.debug(document.cookie)});function onSubmitGapsSearch(){if(validateInput()){search()}}function search(){connect();keepChecking=true;let searchModelTitle=$("#searchModelTitle");let progressContainer=$("#progressContainer");let searchingBody=$("#searchingBody");let modelButton=$("#modelButton");progressContainer.hide();modelButton.text("cancel");searchModelTitle.text("Searching");searchingBody.empty();const a={movieDbApiKey:$("#movie_db_api_key").val(),writeToFile:true,movieDbListId:$("#movie_db_list_id").val(),searchFromPlex:true,connectTimeout:$("#connect_timeout").val(),writeTimeout:$("#write_timeout").val(),readTimeout:$("#read_timeout").val(),movieUrls:$("#plex_movie_urls").val().split("\n")};$.ajax({type:"POST",url:"http://"+$("#address").val()+":"+$("#port").val()+"/submit",data:JSON.stringify(a),contentType:"application/json",timeout:0,success:function(b){keepChecking=false;let movieHtml="";b.forEach(function(c){movieHtml+=buildMovieDiv(c)});progressContainer.hide();searchingBody.html(buildMovies(movieHtml));searchModelTitle.text(b.length+" movies to add to complete your collections");modelButton.text("close");disconnect()},error:function(b){let message="Unknown error. Check docker Gaps log file.";if(b){message=JSON.parse(b.responseText).message}progressContainer.hide();searchingBody.html(message);searchModelTitle.text("An error occurred...");modelButton.text("close");keepChecking=false;disconnect()}});$("#searchModal").modal("open");polling()}function buildMovies(a){return'<ul class="collection">'+a+"</ul>"}function buildMovieDiv(a){return'<li class="collection-item">'+buildMovie(a)+"</li>"}function buildMovie(a){return a.name+" ("+a.year+") from '"+a.collection+"'"}function polling(){if(keepChecking){$.ajax({type:"GET",url:"http://"+$("#address").val()+":"+$("#port").val()+"/status",contentType:"application/json",success:function(a){}})}}function connect(){const a=new SockJS("/gs-guide-websocket");stompClient=Stomp.over(a);stompClient.connect({},function(b){stompClient.subscribe("/topic/searchResults",function(c){showSearchStatus(JSON.parse(c.body))})})}function disconnect(){if(stompClient!==null){stompClient.disconnect()}console.log("Disconnected")}function showSearchStatus(b){if(keepChecking){if(!b.searchedMovieCount&&!b.totalMovieCount&&b.totalMovieCount===0){$("#searchingBody").text("Searching for movies...")}else{$("#progressContainer").show();const a=Math.trunc(b.searchedMovieCount/b.totalMovieCount*100);$("#searchingBody").text(b.searchedMovieCount+" of "+b.totalMovieCount+" movies searched. "+a+"% complete. "+b.moviesFound);$("#progressBar").css("width",a+"%")}}};