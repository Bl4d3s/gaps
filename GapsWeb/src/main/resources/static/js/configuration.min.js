import{Payload}from"/js/modules/payload.min.js";let plexSpinner,plexSaveSuccess,plexSaveError,plexTestSuccess,plexTestError,plexDeleteSuccess,plexDeleteError,plexDuplicateError,tmdbSpinner,tmdbSaveSuccess,tmdbSaveError,tmdbTestSuccess,tmdbTestError,scheduleSpinner,scheduleSaveSuccess,scheduleSaveError,deleteAllError,deleteAllSuccess;function testTmdbKey(){if(hideAllAlertsAndSpinners(),!$("#tmdbConfiguration")[0].checkValidity())return!1;tmdbSpinner.show(),$.ajax({type:"PUT",url:`/configuration/test/tmdbKey/${$("#movieDbApiKey").val()}`,contentType:"application/json",dataType:"json",success:function(result){hideAllAlertsAndSpinners(),result&&result.code===Payload.TMDB_KEY_VALID?tmdbTestSuccess.show():tmdbTestError.show()},error:function(){hideAllAlertsAndSpinners(),tmdbTestError.show()}})}function saveTmdbKey(){if(hideAllAlertsAndSpinners(),!$("#tmdbConfiguration")[0].checkValidity())return!1;tmdbSpinner.show(),$.ajax({type:"POST",url:`/configuration/save/tmdbKey/${$("#movieDbApiKey").val()}`,contentType:"application/json; charset=utf-8",dataType:"json",success:function(result){hideAllAlertsAndSpinners(),result&&result.code===Payload.TMDB_KEY_SAVE_SUCCESSFUL?tmdbSaveSuccess.show():tmdbSaveError.show()},error:function(){hideAllAlertsAndSpinners(),tmdbSaveError.show()}})}function testPlexServer(){if(hideAllAlertsAndSpinners(),!$("#plexConfiguration")[0].checkValidity())return!1;plexSpinner.show(),$.ajax({type:"PUT",url:"/configuration/test/plex",data:{plexToken:$("#plexToken").val(),address:$("#address").val(),port:$("#port").val()},dataType:"json",success:function(result){hideAllAlertsAndSpinners(),result&&result.code===Payload.PLEX_CONNECTION_SUCCEEDED?plexTestSuccess.show():plexTestError.show()},error:function(){hideAllAlertsAndSpinners(),plexTestError.show()}})}function addPlexServer(){if(hideAllAlertsAndSpinners(),!$("#plexConfiguration")[0].checkValidity())return!1;plexSpinner.show(),$.ajax({type:"POST",url:"/configuration/add/plex",data:{plexToken:$("#plexToken").val(),address:$("#address").val(),port:$("#port").val()},error:function(){hideAllAlertsAndSpinners(),plexSaveError.show()}})}function testExistingPlexServer(machineIdentifier){hideAllAlertsAndSpinners(),plexSpinner.show(),$.ajax({type:"PUT",url:`/configuration/test/plex/${machineIdentifier}`,dataType:"json",success:function(result){hideAllAlertsAndSpinners(),result&&result.success?plexTestSuccess.show():plexTestError.show()},error:function(){hideAllAlertsAndSpinners(),plexTestError.show()}})}function removePlexServer(machineIdentifier){hideAllAlertsAndSpinners(),plexSpinner.show(),$.ajax({type:"DELETE",url:`/configuration/delete/plex/${machineIdentifier}`,success:function(result){hideAllAlertsAndSpinners(),result&&result.success?($("#"+machineIdentifier).remove(),plexDeleteSuccess.show()):plexDeleteError.show()},error:function(){hideAllAlertsAndSpinners(),plexDeleteError.show()}})}function saveSchedule(){hideAllAlertsAndSpinners();const id=$("#setSchedule").val();$.ajax({type:"PUT",url:`/schedule/${id}`,success:function(result){hideAllAlertsAndSpinners(),result&&result.code===Payload.SCHEDULE_UPDATED?scheduleSaveSuccess.show():scheduleSaveError.show()},error:function(){hideAllAlertsAndSpinners(),scheduleSaveError.show()}})}function setDeleteAllEnabledOrDisabled(){$("#deleteAll").prop("disabled",!$("#confirmDeleteAll").is(":checked"))}function nuke(){$.ajax({type:"PUT",url:"/nuke",success:function(result){hideAllAlertsAndSpinners(),result&&result.code===Payload.NUKE_SUCCESSFUL?(deleteAllSuccess.show(),$("#movieDbApiKey").val(""),$("#plexServers").html("")):deleteAllError.show()},error:function(){hideAllAlertsAndSpinners(),deleteAllError.show()}})}function hideAllAlertsAndSpinners(){plexSpinner.hide(),tmdbSpinner.hide(),plexTestSuccess.hide(),plexTestError.hide(),plexSaveSuccess.hide(),plexSaveError.hide(),plexDeleteSuccess.hide(),plexDeleteError.hide(),tmdbTestSuccess.hide(),tmdbTestError.hide(),tmdbSaveSuccess.hide(),tmdbSaveError.hide(),deleteAllSuccess.hide(),deleteAllError.hide()}window.addEventListener("load",function(){const forms=document.getElementsByClassName("needs-validation");Array.prototype.filter.call(forms,function(form){form.addEventListener("click",function(event){!1===form.checkValidity()&&(event.preventDefault(),event.stopPropagation()),form.classList.add("was-validated")},!1)})},!1),document.addEventListener("DOMContentLoaded",function(){plexSpinner=$("#plexSpinner"),plexSaveSuccess=$("#plexSaveSuccess"),plexSaveError=$("#plexSaveError"),plexTestSuccess=$("#plexTestSuccess"),plexTestError=$("#plexTestError"),plexDeleteSuccess=$("#plexDeleteSuccess"),plexDeleteError=$("#plexDeleteError"),tmdbSpinner=$("#tmdbSpinner"),tmdbSaveSuccess=$("#tmdbSaveSuccess"),tmdbSaveError=$("#tmdbSaveError"),tmdbTestSuccess=$("#tmdbTestSuccess"),tmdbTestError=$("#tmdbTestError"),plexDuplicateError=$("#plexDuplicateError"),scheduleSpinner=$("#scheduleSpinner"),scheduleSaveSuccess=$("#scheduleSaveSuccess"),scheduleSaveError=$("#scheduleSaveError"),deleteAllError=$("#deleteAllError"),deleteAllSuccess=$("#deleteAllSuccess");const socket=new SockJS("/gs-guide-websocket"),stompClient=Stomp.over(socket);stompClient.connect({},function(frame){console.log("Connected: "+frame),stompClient.subscribe("/configuration/plex/complete",function(message){const payload=JSON.parse(message.body);if(hideAllAlertsAndSpinners(),payload&&payload.code===Payload.PLEX_LIBRARIES_FOUND){plexSaveSuccess.show(),$("#plexToken").val(""),$("#address").val(""),$("#port").val("32400");const plexServerCard=$("#plexServerCard").html(),theCompiledHtml=Handlebars.compile(plexServerCard)(payload.extras);$("#plexServers").append(theCompiledHtml)}else plexSaveError.show()}),stompClient.subscribe("/configuration/plex/duplicate",function(){hideAllAlertsAndSpinners(),plexDuplicateError.show()})}),window.testTmdbKey=testTmdbKey,window.saveTmdbKey=saveTmdbKey,window.testPlexServer=testPlexServer,window.addPlexServer=addPlexServer,window.testExistingPlexServer=testExistingPlexServer,window.removePlexServer=removePlexServer,window.saveSchedule=saveSchedule,window.setDeleteAllEnabledOrDisabled=setDeleteAllEnabledOrDisabled,window.nuke=nuke}),$(function(){$("[data-hide]").on("click",function(){$(this).closest("."+$(this).attr("data-hide")).hide()})});