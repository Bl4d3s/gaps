var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Math.trunc",function(a){return a?a:function(a){a=Number(a);if(isNaN(a)||Infinity===a||-Infinity===a||0===a)return a;var b=Math.floor(Math.abs(a));return 0>a?-b:b}},"es6","es3");
var stompClient,backButton,copyToClipboard,searchResults,searchPosition,progressContainer,searchTitle,searchDescription;
document.addEventListener("DOMContentLoaded",function(){var a=document.querySelectorAll(".modal");M.Modal.init(a);searchResults=$("#searchResults");backButton=$("#cancel");copyToClipboard=$("#copyToClipboard");searchResults=$("#searchResults");searchPosition=$("#searchPosition");progressContainer=$("#progressContainer");searchTitle=$("#searchTitle");searchDescription=$("#searchDescription");backButton.click(function(){$("#warningModal").modal("open")});setCopyToClipboardEnabled(!1);copyToClipboard.click(function(){CopyToClipboard("searchResults");
M.toast({html:"Copied to Clipboard"})});$("#agree").click(function(){$.ajax({type:"PUT",url:"http://"+location.hostname+":"+location.port+"/cancelSearch",contentType:"application/json"});location.assign("index.html")});connect();search()});window.onbeforeunload=function(){disconnect()};function setCopyToClipboardEnabled(a){a?copyToClipboard.removeClass("disabled"):copyToClipboard.addClass("disabled")}
function search(){progressContainer.hide();searchTitle.text("Searching for Movies...");searchDescription.text("Gaps is looking through your Plex libraries. This could take a while so just sit tight and we'll find all the missing movies for you.");for(var a=JSON.parse(document.cookie),b=[],c=$jscomp.makeIterator(a.libraries),d=c.next();!d.done;d=c.next())d="http://"+a.address+":"+a.port+"/library/sections/"+d.value.key+"/all/?"+encodeQueryData({"X-Plex-Token":a.plex_token}),b.push(d);$.ajax({type:"POST",
url:"http://"+location.hostname+":"+location.port+"/submit",data:JSON.stringify({movieDbApiKey:a.movie_db_api_key,writeToFile:!0,searchFromPlex:!0,movieUrls:b}),contentType:"application/json",timeout:0,success:function(a){var b="";a.forEach(function(a){b+=buildMovieDiv(a)});searchTitle.text(a.length+" movies to add to complete your collections");searchDescription.text("Below is everything Gaps found that is missing from your movie collections.");progressContainer.hide();backButton.text("restart");
setCopyToClipboardEnabled(!0)},error:function(a){disconnect();a&&(a=JSON.parse(a.responseText).message,Console.error(a));searchTitle.text("An error occurred...");searchDescription.text("");progressContainer.hide();backButton.text("restart");setCopyToClipboardEnabled(!1)}});showSearchStatus()}function buildMoviesDiv(a){var b="";a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next())b+=buildMovieDiv(c.value);return b}function buildMovieDiv(a){return"<div>"+buildMovie(a)+"</div>"}
function buildMovie(a){return a.name+" ("+a.year+") from '"+a.collection+"'"}function connect(){var a=new SockJS("/gs-guide-websocket");stompClient=Stomp.over(a);stompClient.connect({},function(a){stompClient.subscribe("/topic/currentSearchResults",function(a){a=JSON.parse(a.body);showSearchStatus(a);shouldDisconnect(a)})})}function disconnect(){null!==stompClient&&stompClient.disconnect();console.log("Disconnected")}
function shouldDisconnect(a){a&&a.searchedMovieCount&&a.totalMovieCount&&a.totalMovieCount===a.searchedMovieCount&&(disconnect(),$.ajax({type:"PUT",url:"http://"+location.hostname+":"+location.port+"/cancelSearch",contentType:"application/json"}))}
function showSearchStatus(a){if(a&&(a.searchedMovieCount||a.totalMovieCount||0!==a.totalMovieCount)){progressContainer.show();var b=Math.trunc(a.searchedMovieCount/a.totalMovieCount*100);searchPosition.html("<h5>"+a.searchedMovieCount+" of "+a.totalMovieCount+" movies searched. "+b+"% complete.</h5>");searchResults.html(buildMoviesDiv(a.moviesFound));$("#progressBar").css("width",b+"%")}else searchResults.html("")}
function encodeQueryData(a){var b=[],c;for(c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}function CopyToClipboard(a){if(document.selection){var b=document.body.createTextRange();b.moveToElementText(document.getElementById(a));b.select().createTextRange();document.execCommand("copy")}else window.getSelection&&(b=document.createRange(),b.selectNode(document.getElementById(a)),window.getSelection().addRange(b),document.execCommand("copy"))};
